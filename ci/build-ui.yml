platform: linux

image_resource:
  type: docker-image
  source:
    repository: feeds.axadmin.net/docker/node
    username: ((proget-user))
    password: ((proget-password))

inputs:
  - name: source-git
outputs:
  - name: artifact
  - name: versions
  - name: source-git
run:
  dir: source-git
  path: bash
  args:
    - -exc
    - |
      # Format the version
      version=$(git describe --long | awk -F- '{printf "V%s-%04d-%s", $1, $2, $3}')_dev

      # Navigate to the project directory
      cd source-git
      
      # Install dependencies
      npm install || yarn install

      # Build the project
      npm run build || yarn build

      # Copy the build output to the `build-output` directory for Dockerization
      echo $version > ./build/version.txt
      cp -R ./build ../build-output/

      # (Optional) Additional steps such as linting, testing, etc.
      # npm run lint
      # npm test