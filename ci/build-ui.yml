platform: linux

image_resource:
  type: docker-image
  source:
    repository: node
    tag: '18-alpine'

inputs:
  - name: source-git
outputs:
  - name: build-output
  - name: versions
  - name: source-git
run:
  path: sh
  args:
    - -exc
    - |
      #!/bin/sh
      # Format the version
      version=$(git describe --long | awk -F- '{printf "V%s-%04d-%s", $1, $2, $3}')_dev
      ls -l
      # Navigate to the project directory
      cd source-git
      
      # Install dependencies
      npm install || yarn install

      # Build the project
      npm run build || yarn build

      # Copy the build output to the `build-output` directory for Dockerization
      echo $version > ./build/version.txt
      cp -R ./build ../build-output/

      # (Optional) Additional steps such as linting, testing, etc.
      # npm run lint
      # npm test